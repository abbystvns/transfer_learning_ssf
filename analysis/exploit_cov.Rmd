---
title: "Exploiting the covariance structure in the AltMin procedure"
author: "Abby Stevens"
date: "2020-04-12"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Overview

When trying to combine simulations and observations drawn from our Gaussian setting, we are solving for $\beta$ in the following system:

$$\tilde{y} = \tilde{X} \beta + \epsilon, \quad \quad \epsilon 
\sim N(0, \Sigma_*), \quad \quad \Sigma_* = \begin{bmatrix}
\sigma^2I_{n_o} & 0\\
0 & X_s\Sigma_{\Delta}X_s^T + \sigma^2I_{n_s}\end{bmatrix}$$


where $$ \tilde{y} = \begin{bmatrix}
y_{obs} \\
y_{sim}
\end{bmatrix} \quad \text{and} \quad \tilde{X} = \begin{bmatrix}
X_{obs}\\
X_{sim}
\end{bmatrix}
$$

So the AltMin procedure (where we keep all data in one group) proceeds as follows:


\begin{align*}
\hat{\Sigma}_{(t+1)} &= \left(\tilde{y} - \tilde{X} \hat{\theta}_{(t)}\right) \left(\tilde{y} - \tilde{X} \hat{\theta}_{(t)}\right)^T \\

\hat{\theta}_{(t+1)} &= arg\min_{\theta \in \mathbb{R}^p} \frac{1}{2}\| \hat{\Sigma}_{(t+1)}^{-\frac{1}{2}}(\tilde{y} - \tilde{X}\theta)\|_2^2 \quad \text{s.t.} \quad f(\theta) \leq \lambda
\end{align*}

When the true covariance is known, the MAP estimator achieves good MSE (see [here](map_compare.html) for notebook with code and plot). We want to dig deeper into the estimation of $\Sigma_*$ using AltMin and experiment with ways to exploit the structure in our setting to improve this estimation.

Because our setting is high-dimensional, we know that estimating $\Sigma$ will be difficult. It is possible that this becomes even more difficult because, in the AltMin procedure (or when computing the MAP estimator) we are actually using an estimate of $\Sigma^{-1}$. 

## Tasks

### 1. Least squares covariance estimation
Pose the covariance estimation step in AltMin follows: 


+ $\hat{\sigma}^2 = \frac{1}{n_o}\|y_{obs} - X_{obs}\hat{\theta}\|_2^2$
+ $\hat{\tilde{\Sigma}} = \left(y_{sim} - X_{sim}\hat{\theta}\right)\left(y_{sim} - X_{sim}\hat{\theta}\right)^T$
+ $\hat{\Sigma}_{\Delta} = \text{arg} \min_{\Sigma \succ 0} \|\hat{\tilde{\Sigma}} - X_{sim} \Sigma X_{sim}^T - \hat{\sigma}^2I_{n_s} \|$
+ $\hat{\Sigma}_* = \begin{bmatrix}
\hat{\sigma}^2I_{n_o} & 0\\
0 & X_s\hat{\Sigma}_{\Delta}X_s^T + \hat{\sigma}^2I_{n_s}\end{bmatrix}$

The third step involves an optimization problem over $p \times p$ positive definite matrices - we should test and see what happens to the error as $p$ increases.

### 2. Deep-dive into impact of covariance on AltMin procedure
Following the call on 4/2/20, we should do the following:

1. Plot the accuracy of $\Sigma_{\Delta}$ and $\tilde{\Sigma}^{-1}$ for different combinations of $p$, $n_s$, $n_o$

2. See what happens to these estimates across number of iterations
3. Initilalize AltMin at ground truth $\Sigma_{\Delta}$ and see what happens as the procedure iterates.

Code for initial exploration of this question found [here](covariance_explorations.html).




